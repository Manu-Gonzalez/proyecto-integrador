(l.push(e),!0)))}return!0}))}return t.ranges=l,t.rangeCursor=0,e.documentTypeContext.types[s.sheetIdx.index]=(0,o.makeGridRangeTable)(),e}initialiseRangeCells(e,t){this.lastStepMessage="initialiseRangeCells";const{mutableState:n,stats:r,sheets:s}=t,{sheetCursor:l}=n,c=[],d=s[l],h=n.ranges[n.rangeCursor];return e.forEachServerNonBlankCellInSet(d.sheetIdx,(0,u.createCellSetFromRange)(h),(n=>{const s=(0,o.sheetGridCell)(d.sheetIdx,n),l=e.getServerFormula(s);l.kind===i.ResultKind.Success&&void 0!==l.value?.[1].compiledFmla&&(c.push(l.value[1]),r.formulaCells+=1);const u=e.getServerFormat(s);return u.kind===i.ResultKind.Success&&(0,a.isInterestingFormat)(t.documentTypeContext,u.value)&&(0,a.updateFormatStatsFromCellFormat)(t.documentTypeContext,u.value,r,!1),r.totalCells+=1,!0})),n.cells=c,n.cellCursor=0,t}checkCell(e,t){this.lastStepMessage="checkCell";const{sheets:n,constraints:r,stats:s,mutableState:c}=t,{cells:u,sheetCursor:d,cellCursor:h}=c,g=n[d],m=u[h],v=m.compiledFmla.getValue();if(v.kind===i.ResultKind.Success){const n=(0,o.sheetGridCell)(g.sheetIdx,m.origin),c=function(e,t,n){const{constraints:i,locale:r,mathpack:s,res